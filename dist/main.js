(()=>{"use strict";var e={365:(e,t,n)=>{n.d(t,{A:()=>p});var i=n(601),r=n.n(i),s=n(314),a=n.n(s),o=n(417),l=n.n(o),c=new URL(n(775),n.b),d=a()(r()),h=l()(c);d.push([e.id,`@font-face {\n  font-family: "jost";\n  src: url(${h}) format('woff2');\n}\n\n:root {\n    --cell-size: 2.2vw;\n    --font-color: #e3e3e3;\n    --win-color: #95db83;\n    --lose-color: #ba1735;\n    --hit-cell: #d36b70;\n    --miss-cell: #d3916b;\n    --sunk-cell: #9b142d;\n    --player-placed-ship: #9a6bd3;\n    --valid: #70d36b;\n    --invalid: #b6bcbf;\n    --border-width: 1.5px;\n}\n\np, h1 {\n    margin: 0;\n    padding: 0;\n}\n\nhtml {\n    font-family: "jost";\n    color: var(--font-color);\n    height: 100vh;\n    width: 100vw;\n    font-size: 2vw;\n    text-align: center;\n    overflow: hidden;\n    margin: 0;\n    padding: 0;\n}\n\n.player-cell.invalid-sillhouette {\n    background-color: var(--invalid);\n}\n\n.player-cell.valid-sillhouette {\n    background-color: var(--valid);\n}\n\n.computer-cell.hit, .player-cell.hit  {\n    background-color: var(--hit-cell) !important;\n}\n\n.player-cell.miss, .computer-cell.miss {\n    background-color: var(--miss-cell);\n}\n\n.player-cell.hit, .ship-peg, .computer-cell, .player-cell.miss {\n    transition: all .15s;\n} \n\n.player-cell.placed {\n    background-color: var(--player-placed-ship);\n}\n\n.ship-peg.placed {\n    border: none !important;\n}\n\n.computer-cell, .player-cell {\n    position: static !important;\n    width: var(--cell-size);\n    height: var(--cell-size);\n    border: var(--border-width) solid var(--font-color);\n}\n\n.player-cell .selected {\n    border: var(--border-width) solid orange;\n}\n\n.header-text {\n    box-sizing: border-box;\n    font-size: 1.2em;\n    padding: 1%;\n    width: 100vw;\n    overflow: hidden;\n}\n\n.ui-board {\n    display: grid;\n    grid-template-columns: repeat(10, 1fr);\n    grid-template-rows: repeat(10, 1fr);\n    gap: 0;\n    width: calc(10 * var(--cell-size) + 10 * var(--border-width));\n    padding: 1%;\n}\n\nh1 {\n  padding: 1%;\n}\n\n.ship-container {\n    display: flex;\n    flex-direction: row;\n    justify-content: space-evenly;\n    width: 100vw;\n\n}\n\n.peg-container {\n    display: flex;\n}\n\n.peg-container\n\nh1 {\n    margin: 0;\n    padding: 0;\n}\n\n.ship-peg {\n    border: var(--border-width) solid var(--player-placed-ship);\n    height: var(--cell-size);\n    width: var(--cell-size);\n}\n\nbody {\n    margin: 0;\n    height: 100vh;\n    width: 100vw;\n    background-color: #1f1d1d;\n    padding: 0;\n}\n\n\n\n.board-container {\n    display: grid;\n    grid-template-rows: repeat(2, 2%);\n    grid-template-columns: repeat(2, 1fr);\n    align-items: center;\n    justify-items: center;\n}\n\n/* Credit to Radu Bratan on Codepen for the CSS below: https://codepen.io/RaduBratan/pen/XWWKZxb */\n\n  .splash-container {\n    position: fixed;\n    top: 0;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: center;\n    height: 100vh;\n    width: 100vw;\n    animation: lift 0.8s ease-in-out;\n    animation-delay: 1.6s;\n    animation-fill-mode: forwards;\n  }\n  \n  .win {\n    background: var(--win-color);  \n  }\n\n  .lose {\n    background: var(--lose-color)\n  }\n  \n  .title {\n    font-size: 81px;\n    color: var(--font-color);\n    text-align: center;\n    animation: wave 0.4s, jump 1s;\n    position: relative;\n    top: 0;\n    padding: 4px;\n    /* //transform: translate3d(0, 16%, 0); */\n    opacity: 0;\n    z-index: 3;\n    animation-fill-mode: forwards;\n  }\n  \n  span:nth-of-type(1) {\n    /* //left: 0rem; */\n    animation: wave 0.4s, jump 1.1s ease-in-out alternate 0.05s;\n  }\n  \n  span:nth-of-type(2) {\n    /* //left: 0.8rem; */\n    animation: wave 0.4s, jump 1.1s ease-in-out alternate 0.1s;\n  }\n  \n  span:nth-of-type(3) {\n    /* //left: 1.6rem; */\n    animation: wave 0.4s, jump 1.1s ease-in-out alternate 0.15s;\n  }\n  \n  span:nth-of-type(4) {\n    /* //left: 2.4rem; */\n    animation: wave 0.4s, jump 1.1s ease-in-out alternate 0.2s;\n  }\n  \n  span:nth-of-type(5) {\n    /* //left: 3.2rem; */\n    animation: wave 0.4s, jump 1.1s ease-in-out alternate 0.25s;\n  }\n  \n  span:nth-of-type(6) {\n    /* //left: 4rem; */\n    animation: wave 0.4s, jump 1.1s ease-in-out alternate 0.3s;\n  }\n  \n  @keyframes wave {\n    0% {\n      top: 0%;\n    }\n    100% {\n      top: 100%;\n    }\n  }\n  \n  @keyframes jump {\n    0% {\n      transform: translate3d(0, 0, 0);\n      opacity: 0;\n    }\n    90% {\n      transform: translate3d(0, -16%, 0);\n      opacity: 1;\n    }\n    100% {\n      transform: translate3d(0, -32%, 0);\n      opacity: 1;\n    }\n  }\n  \n  @keyframes lift {\n    0% {\n      transform: translate3d(0, 0, 0);\n      opacity: 1;\n      visibility: visible;\n    }\n    100% {\n      transform: translate3d(0, -100%, 0);\n      opacity: 1;\n      visibility: hidden;\n    }\n  }\n  \n  @keyframes appear {\n    0% {\n      visibility: hidden;\n    }\n    100% {\n      visibility: visible;\n    }\n  } \n  `,""]);const p=d},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,r,s){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(i)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);i&&a[d[0]]||(void 0!==s&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=s),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),t.push(d))}},t}},417:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},601:e=>{e.exports=function(e){return e[1]}},72:e=>{var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var s={},a=[],o=0;o<e.length;o++){var l=e[o],c=i.base?l[0]+i.base:l[0],d=s[c]||0,h="".concat(c," ").concat(d);s[c]=d+1;var p=n(h),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(u);else{var m=r(u,i);i.byIndex=o,t.splice(o,0,{identifier:h,updater:m,references:1})}a.push(h)}return a}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var s=i(e=e||[],r=r||{});return function(e){e=e||[];for(var a=0;a<s.length;a++){var o=n(s[a]);t[o].references--}for(var l=i(e,r),c=0;c<s.length;c++){var d=n(s[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}s=l}}},659:e=>{var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},775:(e,t,n)=>{e.exports=n.p+"59de2b38b1b77348c048.ttf"}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={id:i,exports:{}};return e[i](s,s.exports,n),s.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var r=i.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=i[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.b=document.baseURI||self.location.href,n.nc=void 0;const i=class{#e=1;constructor(e){this.ship_grid=Array(e).fill().map((()=>Array(e).fill(!1))),this.shots=Array(e).fill().map((()=>Array(e).fill(!1))),this.ships=[]}placeShip(e,t,n){return!(!this.isInBounds(e,t,n)||!this.#t(t)||this.willOverlap(e,t,n)||this.ships.includes(e)||(this.ships.push(e),this.#n(e,t,n),this.#e++,0))}#n(e,t,n){if("left"===n&&this.ship_grid[t[1]].fill(this.#e,t[0]-(e.length-1),t[0]+1),"right"===n&&this.ship_grid[t[1]].fill(this.#e,t[0],t[0]+e.length),"up"===n)for(let n=t[1]-(e.length-1);n<=t[1];n++)this.ship_grid[n][t[0]]=this.#e;if("down"===n)for(let n=t[1]+(e.length-1);n>=t[1];n--)this.ship_grid[n][t[0]]=this.#e}isInBounds(e,t,n){switch(n){case"left":return 0<=t[0]-(e.length-1);case"right":return this.ship_grid.length>t[0]+(e.length-1);case"up":return 0<=t[1]-(e.length-1);case"down":return this.ship_grid.length>t[1]+(e.length-1)}}willOverlap(e,t,n){if("down"===n)for(let n=t[1]+(e.length-1);n>=t[1];n--)if(this.ship_grid[n][t[0]])return!0;if("up"===n)for(let n=t[1]-(e.length-1);n<=t[1];n++)if(this.ship_grid[n][t[0]])return!0;if("left"===n)for(let n=t[0]-(e.length-1);n<=t[0];n++)if(this.ship_grid[t[1]][n])return!0;if("right"===n)for(let n=t[0]+(e.length-1);n>=t[0];n--)if(this.ship_grid[t[1]][n])return!0}#t(e){return e[0]<this.ship_grid.length&&e[0]>=0&&e[1]<this.ship_grid.length&&e[1]>=0}recieveAttack(e){const t=e[1],n=e[0];if(!this.#t(e)||this.shots[t][n])return 0;if(this.ship_grid[t][n]){this.shots[t][n]=this.ship_grid[t][n];const e=this.ships[this.ship_grid[t][n]-1];return e.hit(),e.isSunk()&&this.ships.every((e=>e.isSunk()))?2:1}return this.shots[t][n]=-1,-1}update(e){}},r=class{playerType;gameBoard;sideLength;constructor(e,t){this.playerType=e,this.sideLength=t,this.gameBoard=new i(t)}update(e){"reset"===e.event_type&&this.reset()}placeShip(e){return this.gameBoard.placeShip(e.ship.game_logic,e.coords,e.orientation)}recieveAttack(e){return this.gameBoard.recieveAttack(e)}reset(){this.gameBoard=new i(this.sideLength)}},s=class{constructor(e){this.hits=0,this.length=e}hit(){this.hits++}isSunk(){return this.hits===this.length}},a=class{#i=[];constructor(e){this.#i=e}notifyObservers(e){this.#i.forEach((t=>{t.update(e)}))}recieveAttack(e,t){t.result=e.recieveAttack(t.coords),this.notifyObservers(t)}placeShip(e,t){t.result=e.placeShip(t),this.notifyObservers(t)}addObserver(e){this.#i=[...this.#i,e]}},o=class{container=document.createElement("div");pegs=[];length;constructor(e){this.length=e;for(let e=0;e<this.length;e++){let e=document.createElement("div");e.classList.add("ship-peg"),this.container.appendChild(e),this.pegs.push(e)}this.container.classList.add("peg-container")}removeBorder(){this.pegs.forEach((e=>e.classList.add("placed")))}reset(e){this.container.replaceWith(e),this.container=e,this.pegs=[...this.container.children]}};n(775);var l=n(72),c=n.n(l),d=n(825),h=n.n(d),p=n(659),u=n.n(p),m=n(56),g=n.n(m),v=n(540),f=n.n(v),y=n(113),w=n.n(y),I=n(365),b={};b.styleTagTransform=w(),b.setAttributes=g(),b.insert=u().bind(null,"head"),b.domAPI=h(),b.insertStyleElement=f(),c()(I.A,b),I.A&&I.A.locals&&I.A.locals;const E=document.createElement("h1"),x=document.createElement("div"),S=(document.createElement("div"),document.createElement("div")),_=document.createElement("nav"),B=document.createElement("p"),L=document.createElement("p"),C=document.createElement("p"),k=document.createElement("p");B.classList.add("header-text"),L.classList.add("header-text"),E.textContent="Battleship",B.textContent="Your Ships",C.textContent="Your Board",k.textContent="CPU Board";const A=new class{BOARD_SIZE=10;ORIENTATION_MAPPING={1:"right",2:"down",3:"left",4:"up"};#r;#s=new r("p",this.BOARD_SIZE);#a=new r("cpu",this.BOARD_SIZE);#o=[{game_logic:new s(5),ui:new o(5)},{game_logic:new s(4),ui:new o(4)},{game_logic:new s(3),ui:new o(3)},{game_logic:new s(3),ui:new o(3)},{game_logic:new s(2),ui:new o(2)}];#l=[{game_logic:new s(5),ui:new o(5)},{game_logic:new s(4),ui:new o(4)},{game_logic:new s(3),ui:new o(3)},{game_logic:new s(3),ui:new o(3)},{game_logic:new s(2),ui:new o(2)}];playerUIBoard;computerUIBoard;#c;boardContainer;#d=new a([this.#s,this.#a,this]);constructor(e,t,n){t.classList.add("board-container"),e.classList.add("ship-container"),[this.playerUIBoard,this.computerUIBoard]=this.#h(),t.appendChild(this.playerUIBoard),t.appendChild(this.computerUIBoard),this.#l.forEach(((e,t)=>{e.ui.container.dataset.index=t})),this.#o.forEach(((t,n)=>{t.ui.container.dataset.index=n,e.appendChild(t.ui.container)})),this.boardContainer=t,this.#c=n}#h(){const e=document.createElement("div"),t=document.createElement("div");for(let n=0;n<this.BOARD_SIZE;n++)for(let i=0;i<this.BOARD_SIZE;i++){const r=document.createElement("div"),s=document.createElement("div");s.classList.add("computer-cell"),r.classList.add("player-cell"),s.dataset.x=i,s.dataset.y=n,r.dataset.x=i,r.dataset.y=n,e.appendChild(r),t.appendChild(s)}return e.classList.add("ui-board"),t.classList.add("ui-board"),[e,t]}update(e){if("attack"===e.event_type&&("cpu"===e.player.playerType?2!==e.result?[...this.computerUIBoard.children][e.coords[1]*this.BOARD_SIZE+e.coords[0]].classList.add(1===e.result?"hit":"miss"):this.#p(this.#s):2!==e.result?[...this.playerUIBoard.children][e.coords[1]*this.BOARD_SIZE+e.coords[0]].classList.add(1===e.result?"hit":"miss"):this.#p(this.#a)),"place_ship"===e.event_type&&"p"===e.player.playerType)if(e.result){const t=()=>{[...this.playerUIBoard.children].forEach((e=>{e.classList.remove("invalid-sillhouette"),e.classList.remove("valid-sillhouette")}))},n=e.orientation,i="down"===n||"up"===n?e.coords[1]:e.coords[0],r="down"===n||"right"===n?Math.min(this.BOARD_SIZE,i+e.ship.game_logic.length):Math.max(0,i-e.ship.game_logic.length+1);t(),this.#u([parseInt(e.coords[0]),parseInt(e.coords[1])],n,r).forEach((e=>e.classList.add("placed"))),e.ship.ui.removeBorder()}else e.ship.ui.container.style.position="static",e.ship.ui.container.style.transition="none",e.ship.ui.container.style.transform="rotate(0deg)",e.ship.ui.container.style.pointerEvents="auto";if("game_win"===e.event_type&&(this.#r=e.winner,this.#m(("p"===this.#r?"Player":"Computer")+" wins"),this.#g(["You","p"===this.#r?"Win!":"Lose"]).classList.add("p"===this.#r?"win":"lose"),this.#d.notifyObservers({event_type:"reset"})),"reset"===e.event_type){const[e,t]=this.#h();this.playerUIBoard.replaceWith(e),this.playerUIBoard=e,this.computerUIBoard.replaceWith(t),this.computerUIBoard=t,this.#o.forEach(((e,t)=>{const n=document.createElement("div");n.classList.add("peg-container"),n.dataset.index=t;for(let t=0;t<e.game_logic.length;t++){let e=document.createElement("div");e.classList.add("ship-peg"),n.appendChild(e)}e.ui.reset(n),e.game_logic.hits=0})),this.#l.forEach((e=>{e.game_logic.hits=0}))}}#g(e){const t=document.createElement("div");return t.classList.add("splash-container"),e.forEach((e=>{const n=document.createElement("span");n.classList.add("title"),n.textContent=e,t.appendChild(n)})),t.addEventListener("animationend",(e=>{"lift"===e.animationName&&t.remove()})),document.body.prepend(t),t}#p(e){const t={event_type:"game_win",winner:e.playerType};this.#d.notifyObservers(t)}gameLoop(){let e=[...this.#o],t=[...this.#l];this.#v(e).then((e=>{this.#f(t),this.#y()}))}#y(){this.#w().then((e=>this.#r?(this.#r=void 0,void this.gameLoop()):(this.#I(),this.#r?(this.#r=void 0,void this.gameLoop()):void this.#y())))}#f(e){for(;e.length>0;){let t=this.ORIENTATION_MAPPING[Math.floor(4*Math.random())+1],n=this.#b(e[e.length-1].game_logic,t);const i=n[Math.floor(Math.random()*n.length)];this.#E(this.#a,e[e.length-1].ui.container,i,t),e.pop()}}#b(e,t){const n=[];for(let i=0;i<10;i++)for(let r=0;r<10;r++)this.#a.gameBoard.isInBounds(e,[i,r],t)&&!this.#a.gameBoard.willOverlap(e,[i,r],t)&&n.push([i,r]);return n}#x(e){return new Promise((t=>{e.addEventListener("click",(()=>{t(e)}))}))}async#v(e){const t={x:void 0,y:void 0},n=()=>{[...this.playerUIBoard.children].forEach((e=>{e.classList.remove("invalid-sillhouette"),e.classList.remove("valid-sillhouette")}))},i=e=>{e.preventDefault()};if(n(),0===e.length)return new Promise((e=>{e()}));this.#m("Click on a ship to select it"),e.forEach((e=>{e.ui.container.classList.remove("selected")}));let r=0,s=0,a=0,o=0;const l=e.map((e=>this.#x(e.ui.container)));let c=0;const d=await Promise.race(l);let h="right";this.#m("Mouse over a valid cell and press LMB to place, RMB to rotate, d to deselect");const p=e=>{if(2===e.button){if(c++,d.style.transition="transform 0.08s ease",d.style.transformOrigin="calc(var(--cell-size) / 2) calc(var(--cell-size) / 2)",d.style.transform=`rotate(${90*c}deg)`,h=this.ORIENTATION_MAPPING[c%4+1],void 0===t.x||void 0===t.y)return;const i="down"===h||"up"===h?t.y:t.x,r="down"===h||"right"===h?Math.min(this.BOARD_SIZE,i+this.#o[parseInt(d.dataset.index)].game_logic.length):Math.max(0,i-this.#o[parseInt(d.dataset.index)].game_logic.length+1);let s;n(),s="down"===h||"right"===h?this.BOARD_SIZE>=i+this.#o[parseInt(d.dataset.index)].game_logic.length&&!this.#s.gameBoard.willOverlap(this.#o[parseInt(d.dataset.index)].game_logic,[parseInt(e.target.dataset.x),parseInt(e.target.dataset.y)],h)?"valid-sillhouette":"invalid-sillhouette":0<=i-this.#o[parseInt(d.dataset.index)].game_logic.length+1&&!this.#s.gameBoard.willOverlap(this.#o[parseInt(d.dataset.index)].game_logic,[parseInt(e.target.dataset.x),parseInt(e.target.dataset.y)],h)?"valid-sillhouette":"invalid-sillhouette",this.#u([parseInt(e.target.dataset.x),parseInt(e.target.dataset.y)],h,r).forEach((e=>e.classList.add(s)))}},u=e=>{t.x=parseInt(e.target.dataset.x),t.y=parseInt(e.target.dataset.y);const n="down"===h||"up"===h?parseInt(e.target.dataset.y):parseInt(e.target.dataset.x),i="down"===h||"right"===h?Math.min(this.BOARD_SIZE,n+this.#o[parseInt(d.dataset.index)].game_logic.length):Math.max(0,n-this.#o[parseInt(d.dataset.index)].game_logic.length+1);let r;r="down"===h||"right"===h?this.BOARD_SIZE>=n+this.#o[parseInt(d.dataset.index)].game_logic.length&&!this.#s.gameBoard.willOverlap(this.#o[parseInt(d.dataset.index)].game_logic,[parseInt(e.target.dataset.x),parseInt(e.target.dataset.y)],h)?"valid-sillhouette":"invalid-sillhouette":0<=n-this.#o[parseInt(d.dataset.index)].game_logic.length+1&&!this.#s.gameBoard.willOverlap(this.#o[parseInt(d.dataset.index)].game_logic,[parseInt(e.target.dataset.x),parseInt(e.target.dataset.y)],h)?"valid-sillhouette":"invalid-sillhouette",this.#u([parseInt(e.target.dataset.x),parseInt(e.target.dataset.y)],h,i).forEach((e=>e.classList.add(r)))},m=(e=>{const t=t=>{const n=t.clientX,i=t.clientY;a+=1.5*(n-r),o+=1.5*(i-s),r+=a,s+=o,e.style.position="absolute",e.style.pointerEvents="none",e.style.left=n-e.offsetHeight/2+"px",e.style.top=i-e.offsetHeight/2+"px"};return document.addEventListener("mousemove",t),t})(d);d.classList.add("selected"),document.addEventListener("mousedown",p);let g,v,f=[...this.playerUIBoard.children].map((e=>this.#x(e))),y=new Promise((e=>{g=t=>{if(v)document.removeEventListener("keydown",g);else if("d"===t.key||"D"===t.key){document.removeEventListener("mousedown",p),d.classList.remove("selected"),document.removeEventListener("keydown",g),document.removeEventListener("mousemove",m),d.style.position="static",document.removeEventListener("contextmenu",i);const t=JSON.parse(JSON.stringify(d.style.transition));d.style.transition="none",d.style.transform="rotate(0deg)",d.style.transform=t,d.style.pointerEvents="auto",[...this.playerUIBoard.children].forEach((e=>e.removeEventListener("mouseover",u))),[...this.playerUIBoard.children].forEach((e=>e.removeEventListener("mouseleave",n))),[...this.playerUIBoard.children].forEach((e=>e.removeEventListener("mouseleave",this.#x))),e("deselect")}},document.addEventListener("keydown",(e=>g(e)))}));if(f.push(y),document.addEventListener("contextmenu",i),[...this.playerUIBoard.children].forEach((e=>e.addEventListener("mouseover",u))),[...this.playerUIBoard.children].forEach((e=>e.addEventListener("mouseleave",n))),v=await Promise.race(f),"deselect"===v)return this.#v(e);const w=this.#E(this.#s,d,[parseInt(v.dataset.x),parseInt(v.dataset.y)],h);return document.removeEventListener("contextmenu",i),document.removeEventListener("mousedown",p),document.dispatchEvent(new KeyboardEvent("keydown",{key:"d",keyCode:68,code:"KeyD",which:68,bubbles:!0})),document.removeEventListener("mousemove",m),[...this.playerUIBoard.children].forEach((e=>e.removeEventListener("mouseover",u))),[...this.playerUIBoard.children].forEach((e=>e.removeEventListener("mouseleave",n))),w&&(e=e.filter((e=>e.ui.container!=d))),d.classList.remove("selected"),this.#v(e)}#u(e,t,n){const i=e[0],r=e[1],s=[];switch(t){case"down":for(let e=r;e<n;e++)s.push(this.playerUIBoard.children[e*this.BOARD_SIZE+i]);break;case"up":for(let e=r;e>=n;e--)s.push(this.playerUIBoard.children[e*this.BOARD_SIZE+i]);break;case"left":for(let e=i;e>=n;e--)s.push(this.playerUIBoard.children[r*this.BOARD_SIZE+e]);break;case"right":for(let e=i;e<n;e++)s.push(this.playerUIBoard.children[r*this.BOARD_SIZE+e])}return s}async#w(){if(this.#r)return new Promise((e=>e()));this.#m("Select a cell to shoot");const e=[...this.computerUIBoard.children].filter((e=>{let t=[...e.classList];return!(t.includes("hit")||t.includes("miss"))})).map((e=>this.#x(e))),t=await Promise.race(e);return[...this.computerUIBoard.children].forEach((e=>e.removeEventListener("click",this.#x))),this.#S(this.#a,[parseInt(t.dataset.x),parseInt(t.dataset.y)]),new Promise((e=>e([this.#a,this.selectedCell])))}#I(){if(this.#r)return;const e=[...this.playerUIBoard.children].filter((e=>!([...e.classList].includes("miss")||[...e.classList].includes("hit")))),t=e[Math.floor(Math.random()*e.length)];this.#S(this.#s,[parseInt(t.dataset.x),parseInt(t.dataset.y)])}#m(e){this.#c.textContent=e}#E(e,t,n,i){const r={event_type:"place_ship",player:e,ship:t="p"===e.playerType?this.#o[t.dataset.index]:this.#l[t.dataset.index],coords:n,orientation:i};return this.#d.placeShip(e,r),r.result}#S(e,t){const n={event_type:"attack",player:e,coords:t};return this.#d.recieveAttack(e,n),n.result}}(x,S,L);S.appendChild(C),S.appendChild(k),S.appendChild(A.playerUIBoard),S.appendChild(A.computerUIBoard),_.appendChild(E),_.appendChild(L),document.body.appendChild(_),document.body.appendChild(S),document.body.appendChild(B),document.body.appendChild(x),A.gameLoop()})();